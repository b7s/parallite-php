#!/usr/bin/env php
<?php

declare(strict_types=1);

// Find the autoloader - works both in development and when installed as dependency
foreach ([
    __DIR__.'/../vendor/autoload.php',
    __DIR__.'/../../../autoload.php',
] as $file) {
    if (file_exists($file)) {
        require_once $file;
        break;
    }
}

if (!class_exists('Parallite\Installer')) {
    echo "Error: Could not find Parallite autoloader.\n";
    exit(1);
}

use Parallite\Installer;

try {
    // Check for --force flag
    $force = in_array('--force', $argv, true);
    
    // Check for --version parameter
    $version = null;
    foreach ($argv as $arg) {
        if (str_starts_with($arg, '--version=')) {
            $version = substr($arg, strlen('--version='));
            break;
        }
    }
    
    Installer::update(force: $force, version: $version);
    exit(0);
} catch (Throwable $e) {
    echo "Error: {$e->getMessage()}\n";
    exit(1);
}
